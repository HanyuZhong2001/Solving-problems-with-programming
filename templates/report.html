{% extends "base.html" %}
{% block content %}
<a class="back" href="{{ url_for('index') }}" aria-label="Back to input">← Back</a>
<h2 class="title">Report: {{ product.name }} ({{ product.product_id }})</h2>
<p class="meta">Brand: {{ product.brand }} · Category: {{ product.category }}</p>

<div class="grid">
  <section class="card">
    <h3>Scores</h3>
    <p class="score">Total: <strong>{{ scores.T }}</strong> / 100</p>
    <p>Authority: {{ scores.A }} · Consumer: {{ scores.C }}</p>
    <h4>Breakdown</h4>
    <ul>
      {% for line in breakdown %}
        <li>{{ line }}</li>
      {% endfor %}
    </ul>
  </section>

  <section class="card">
    <h3>Risk Flags</h3>
    {% if flags and flags|length > 0 %}
      <div class="flags">
        {% for f in flags %}<span class="pill">{{ f }}</span>{% endfor %}
      </div>
    {% else %}
      <p class="ok">No critical flags</p>
    {% endif %}

    <h3>Authority Notice</h3>
    {% if authority and authority.notice_url %}
      <p><a href="{{ authority.notice_url }}" target="_blank" rel="noopener">Open notice</a></p>
    {% else %}
      <p>None</p>
    {% endif %}
  </section>

  <section class="card">
    <h3>Recent Reviews</h3>
    {% if recent_reviews %}
      <ul>
        {% for r in recent_reviews %}
          <li>{{ r.review_date.date() if r.review_date else "" }} · ★{{ r.rating }} · rep={{ r.reviewer_reputation }} · 
            {% if r.evidence_url %}<a href="{{ r.evidence_url }}" target="_blank" rel="noopener">evidence</a>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No recent reviews.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
