{% extends "base.html" %}
{% block content %}
<div class="center-box">
  <a class="back" href="{{ url_for('index') }}">← Back</a>
  <h2 class="title">Report: {{ product.name }} ({{ product.product_id }})</h2>
  <p class="meta">Brand: {{ product.brand }} · Category: {{ product.category }}</p>

  <section class="card">
    <h3>Overall Score</h3>
    {% set score = scores.T %}
    <div class="score-box
         {% if score < 40 %}score-red
         {% elif score < 70 %}score-yellow
         {% else %}score-green{% endif %}">
      <p class="score-value">{{ scores.T }}</p>
      {% if score < 40 %}
        <p class="score-text">⚠ Not recommended to buy</p>
      {% elif score < 70 %}
        <p class="score-text">⚠ Use caution, mixed reliability</p>
      {% else %}
        <p class="score-text">✅ Recommended to buy</p>
      {% endif %}
    </div>

    <h4>Breakdown</h4>
    <ul>
      {% for line in breakdown %}
        <li>{{ line }}</li>
      {% endfor %}
    </ul>
  </section>

  <section class="card">
    <h3>Risk Flags</h3>
    {% if flags and flags|length > 0 %}
      <div class="flags">
        {% for f in flags %}<span class="pill">{{ f }}</span>{% endfor %}
      </div>
    {% else %}
      <p class="ok">No critical flags</p>
    {% endif %}

    <h3>Authority Notice</h3>
    {% if authority and authority.notice_url %}
      <p><a href="{{ authority.notice_url }}" target="_blank">Open notice</a></p>
    {% else %}
      <p>None</p>
    {% endif %}
  </section>

  <section class="card">
    <h3>Recent Reviews</h3>
    {% if recent_reviews %}
      <ul>
        {% for r in recent_reviews %}
          <li>{{ r.review_date.date() if r.review_date else "" }} · ★{{ r.rating }} · rep={{ r.reviewer_reputation }} ·
            {% if r.evidence_url %}<a href="{{ r.evidence_url }}" target="_blank">evidence</a>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No recent reviews.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
